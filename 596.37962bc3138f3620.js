"use strict";(self.webpackChunksecurework_front=self.webpackChunksecurework_front||[]).push([[596],{3596:(Ae,U,c)=>{c.r(U),c.d(U,{CrudModule:()=>xe});var f=c(9808),l=c(2382),y=c(3865),m=c(8578),u=c(5861),e=c(4893),h=c(1188),x=c(520),v=c(4464),I=c(1665),_=c(1553);let C=(()=>{class o{constructor(t,i,r){this.configService=t,this.httpClient=i,this.localSecureService=r,this.headers=new x.WM({Accept:"application/json","Content-Type":"application/json; charset=utf-8"})}setHeaders(t){const i=this.localSecureService.getValue("currentUser"),r=i?`${i.token}`:"";let s=this.headers.set("ApiKey",t);return s=s.set("Authorization",`Bearer ${r}`),s}GetUsers(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),a=`${r.api_url}/Admin/User/GetUsers?idUsuario=${t}`,d=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.get(a,{headers:d}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}CreateUser(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),s=`${r.api_url}/Admin/User/CreateUser`,a=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.post(s,t,{headers:a}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}UpdateUser(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),s=`${r.api_url}/Admin/User/UpdateUser`,a=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.put(s,t,{headers:a}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}DeleteUser(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),a=`${r.api_url}/Admin/User/DeleteUser?idUsuario=${t}`,d=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.delete(a,{headers:d}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}GetCustomers(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),a=`${r.api_url}/Admin/Customer/GetCustomers?idCliente=${t}`,d=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.get(a,{headers:d}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}CreateCustomer(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),s=`${r.api_url}/Admin/Customer/CreateCustomer`,a=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.post(s,t,{headers:a}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}UpdateCustomer(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),s=`${r.api_url}/Admin/Customer/UpdateCustomer`,a=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.put(s,t,{headers:a}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}DeleteCustomer(t){var i=this;return(0,u.Z)(function*(){try{const r=yield i.configService.getConfig(),a=`${r.api_url}/Admin/Customer/DeleteCustomer?idCliente=${t}`,d=i.setHeaders(r.apikey);return yield(0,v.n)(i.httpClient.delete(a,{headers:d}))}catch(r){return{status:!1,code:null==r?void 0:r.status,message:null==r?void 0:r.statusText}}})()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(I.E),e.LFG(x.eN),e.LFG(_.b))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Z=c(5459);function q(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.idClient)}}function N(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa un nombre. "),e.qZA())}function F(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Nombre debe ser m\xednimo de 5 caracteres. "),e.qZA())}function J(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,N,3,0,"div",7),e.YNc(2,F,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.nombre.errors.required),e.xp6(1),e.Q6J("ngIf",t.f.nombre.errors.minLength)}}function Y(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa una sucursal. "),e.qZA())}function k(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,Y,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.codSucursal.errors.required)}}function Q(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa un ID de oficina en turnos. "),e.qZA())}function P(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,Q,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.idOficinaTurno.errors.required)}}function D(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa una hora de inicio. "),e.qZA())}function L(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,D,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.hInicio.errors.required)}}function E(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa una hora de fin. "),e.qZA())}function V(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,E,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.hFin.errors.required)}}function M(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa un c\xf3digo de sucursal. "),e.qZA())}function O(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,M,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.codLugarIMED.errors.required)}}function $(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa un rut convenio. "),e.qZA())}function z(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",38),e._uU(2," Por favor, ingresa un rut convenio v\xe1lido. "),e.qZA())}function R(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,$,3,0,"div",7),e.YNc(2,z,3,0,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.rutConvenio.errors.required),e.xp6(1),e.Q6J("ngIf",(null==t.f.rutConvenio.value?null:t.f.rutConvenio.value.length)>0&&t.f.rutConvenio.errors.rutInvalid)}}const G=function(){return["/admin/clientes"]},p=function(o){return{"is-invalid":o}};let S=(()=>{class o{constructor(t,i,r,s,a,d,b){this.router=t,this.route=i,this.rutService=r,this.formBuilder=s,this.adminService=a,this.sweetAlertService=d,this.localSecureService=b,this.title="Crear",this.sucursales=[],this.isSubmitted=!1,this.btnDisable=!1}ngOnInit(){this.validaUser()}validaUser(){var t=this;return(0,u.Z)(function*(){t.usuario=t.localSecureService.getValue("currentUser"),1===t.usuario.idPerfil?(t.initForm(),t.getParams()):(yield t.sweetAlertService.swalInfo("warning","\xa1Lo sentimos!","No posee los permisos necesarios para realizar esta acci\xf3n."))&&t.router.navigate(["/dashboard"])})()}getParams(){this.idClient=parseInt(this.route.snapshot.paramMap.get("id")||"0",0),this.idClient>0&&(this.title="Editar",this.readClient())}get f(){return this.formulario.controls}initForm(){this.formulario=this.formBuilder.group({nombre:["",l.kI.required],hInicio:["",l.kI.required],hFin:["",l.kI.required],status:[!1]})}formaterRut(t,i){var r;t.patchValue({[i]:this.rutService.formateaRut(null===(r=t.value)||void 0===r?void 0:r[i])})}readClient(){var t=this;return(0,u.Z)(function*(){t.sweetAlertService.swalLoading();const i=yield t.adminService.GetCustomers(t.idClient);t.sweetAlertService.swalClose(),i.success?t.setValues(i.data):(yield t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",i.message))&&t.router.navigate(["admin/clientes"])})()}setValues(t){var i,r;const s=t.horaI.split(":"),a=t.horaf.split(":");this.formulario.patchValue({nombre:t.oficina,hInicio:3===s.length?null===(i=t.horaI)||void 0===i?void 0:i.slice(0,-3):t.horaI,hFin:3===a.length?null===(r=t.horaf)||void 0===r?void 0:r.slice(0,-3):t.horaf,status:t.ok})}onSubmit(){this.isSubmitted=!0,this.formulario.valid&&(this.idClient>0?this.updateClient():this.createClient())}updateClient(){var t=this;return(0,u.Z)(function*(){var i;const r={idCliente:null!==(i=t.idClient)&&void 0!==i?i:0,razonSocial:t.f.razonSocial.value,direccion:t.f.direccion.value,telefono:t.f.telefono.value,email:t.f.email.value,idComuna:parseInt(t.f.idComuna.value),idContrato:null,status:t.f.status.value};t.sweetAlertService.swalLoading();const s=yield t.adminService.UpdateCustomer(r);t.sweetAlertService.swalClose(),s.success?(yield t.sweetAlertService.swalInfo("success","\xa1Editado!","\xa1La oficina ha sido editada con \xe9xito!"),t.router.navigate(["admin/clientes"])):t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",s.message)})()}createClient(){var t=this;return(0,u.Z)(function*(){const i={razonSocial:t.f.razonSocial.value,rut:t.f.rut.value,direccion:t.f.direccion.value,telefono:t.f.telefono.value,email:t.f.email.value,idComuna:parseInt(t.f.idComuna.value),idContrato:null};t.sweetAlertService.swalLoading();const r=yield t.adminService.CreateCustomer(i);t.sweetAlertService.swalClose(),r.success?(yield t.sweetAlertService.swalInfo("success","\xa1Creado!","\xa1La oficina ha sido creada con \xe9xito!"),t.router.navigate(["admin/clientes"])):t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",r.message)})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.F0),e.Y36(m.gz),e.Y36(h.o),e.Y36(l.qu),e.Y36(C),e.Y36(Z.T),e.Y36(_.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-form-client"]],decls:62,vars:35,consts:[[1,"container-fluid"],[1,"row"],[1,"col-xl-8","mx-auto"],[1,"card"],[1,"card-header","mt-2"],[1,"col-xl-6"],[1,"text-dark","text-start"],[4,"ngIf"],[1,"col-xl-6","text-end"],[1,"btn","btn-primary","text-white",3,"routerLink"],[1,"c-icon","fas","fa-arrow-left"],[1,"card-body"],[1,"row",3,"formGroup"],[1,"col-xl-6","mx-auto","mt-xl-2","text-center"],["for","status"],[1,"form-check","form-switch"],[1,"switch"],["type","checkbox","formControlName","status",1,"form-check-input","my-auto"],[1,"col-xl-6","mt-xl-3"],["for","nombre"],["type","text","formControlName","nombre",1,"form-control","text-capitalize",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","codSucursal"],["type","text","formControlName","codSucursal",1,"form-control","text-capitalize",3,"ngClass"],[1,"col-xl-4","mt-xl-3"],["for","idOficinaTurno"],["type","text","formControlName","idOficinaTurno",1,"form-control","text-capitalize",3,"ngClass"],["for","hInicio"],["type","time","formControlName","hInicio",1,"form-control",3,"ngClass"],["for","hFin"],["type","time","formControlName","hFin",1,"form-control",3,"ngClass"],["for","codLugarIMED"],["type","text","formControlName","codLugarIMED",1,"form-control","text-capitalize",3,"ngClass"],["for","rutConvenio"],["type","text","formControlName","rutConvenio","maxlength","12",1,"form-control","text-capitalize",3,"ngClass","keyup"],[1,"col-xl-12","text-center","mt-5"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"invalid-feedback"],[1,"far","fa-times-circle"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",1)(6,"div",5)(7,"h4",6),e._uU(8),e.YNc(9,q,2,1,"span",7),e.qZA()(),e.TgZ(10,"div",8)(11,"button",9),e._UZ(12,"i",10),e._uU(13,"\xa0\xa0\xa0Volver "),e.qZA()()()(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"label",14),e._uU(18,"Puede habilitar o deshabilitar cliente"),e.qZA(),e.TgZ(19,"div",15)(20,"label",16),e._UZ(21,"input",17),e.qZA(),e.TgZ(22,"span"),e._uU(23),e.qZA()()(),e.TgZ(24,"div",18)(25,"label",19),e._uU(26,"Nombre"),e.qZA(),e._UZ(27,"input",20),e.YNc(28,J,3,2,"div",21),e.qZA(),e.TgZ(29,"div",18)(30,"label",22),e._uU(31,"Sucursal"),e.qZA(),e._UZ(32,"input",23),e.YNc(33,k,2,1,"div",21),e.qZA(),e.TgZ(34,"div",24)(35,"label",25),e._uU(36,"ID oficina turno"),e.qZA(),e._UZ(37,"input",26),e.YNc(38,P,2,1,"div",21),e.qZA(),e.TgZ(39,"div",24)(40,"label",27),e._uU(41,"Inicio"),e.qZA(),e._UZ(42,"input",28),e.YNc(43,L,2,1,"div",21),e.qZA(),e.TgZ(44,"div",24)(45,"label",29),e._uU(46,"Fin"),e.qZA(),e._UZ(47,"input",30),e.YNc(48,V,2,1,"div",21),e.qZA(),e.TgZ(49,"div",24)(50,"label",31),e._uU(51,"C\xf3digo Lugar IMED"),e.qZA(),e._UZ(52,"input",32),e.YNc(53,O,2,1,"div",21),e.qZA(),e.TgZ(54,"div",24)(55,"label",33),e._uU(56,"RUT convenio"),e.qZA(),e.TgZ(57,"input",34),e.NdJ("keyup",function(){return i.formaterRut(i.formulario,"rutConvenio")}),e.qZA(),e.YNc(58,R,3,2,"div",21),e.qZA()(),e.TgZ(59,"div",35)(60,"button",36),e.NdJ("click",function(){return i.onSubmit()}),e._uU(61,"Guardar"),e.qZA()()()()()()()),2&t&&(e.xp6(8),e.hij("",i.title," Cliente "),e.xp6(1),e.Q6J("ngIf",i.idClient),e.xp6(2),e.Q6J("routerLink",e.DdM(20,G)),e.xp6(4),e.Q6J("formGroup",i.formulario),e.xp6(8),e.Oqu(i.f.status.value?"Habilitado":"Deshabilitado"),e.xp6(4),e.Q6J("ngClass",e.VKq(21,p,i.isSubmitted&&i.f.nombre.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.nombre.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(23,p,i.isSubmitted&&i.f.codSucursal.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.codSucursal.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(25,p,i.isSubmitted&&i.f.idOficinaTurno.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.idOficinaTurno.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(27,p,i.isSubmitted&&i.f.hInicio.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.hInicio.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(29,p,i.isSubmitted&&i.f.hFin.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.hFin.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(31,p,i.isSubmitted&&i.f.codLugarIMED.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.codLugarIMED.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(33,p,i.isSubmitted&&(null==i.f.rutConvenio?null:i.f.rutConvenio.errors))),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.rutConvenio.errors),e.xp6(2),e.Q6J("disabled",i.btnDisable))},directives:[f.O5,m.rH,l.JL,l.sg,l.Wl,l.JJ,l.u,l.Fj,f.mk,l.nD],styles:[""]}),o})();var A=c(7996),T=c(6936);function H(o,n){1&o&&(e.TgZ(0,"div",12)(1,"h4"),e._uU(2," Sin registros de clientes "),e.qZA()())}const K=function(){return[]};function B(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"app-datatable",14),e.NdJ("changeAction",function(r){return e.CHM(t),e.oxw().action(r)}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Tol("table-bordered border fs-6"),e.Q6J("columnas",t.columns)("data",t.clientData)("dom",t.dom)("buttons",e.DdM(6,K))}}let j=(()=>{class o{constructor(t,i,r,s,a,d){this.router=t,this.rutService=i,this.adminService=r,this.emitDataService=s,this.sweetAlertService=a,this.localSecureService=d,this.clientData=[],this.columns=[],this.dom=""}ngOnInit(){this.validaUser()}validaUser(){var t=this;return(0,u.Z)(function*(){t.usuario=t.localSecureService.getValue("currentUser"),1===t.usuario.idPerfil?t.readClient():(yield t.sweetAlertService.swalInfo("warning","\xa1Lo sentimos!","No posee los permisos necesarios para ver este \xedtem."))&&t.router.navigate(["/dashboard"])})()}getColumnas(){this.dom='<"row"<"col-xl-6"B><"col-xl-6"f>><"row"<"col-xl-12"tr>><"row"<"col-xl-4"i><"col-xl-4"l><"col-xl-4"p>>',this.columns=[{title:"Cliente",data:"razonSocial",className:"dt-center dt-body-left"},{title:"Rut",data:"rut",className:"dt-center dt-body-right",render:t=>this.rutService.formateaRut(t)},{title:"Tel\xe9fono",data:"telefono",className:"dt-center dt-body-left"},{title:"Email",data:"email",className:"dt-center dt-body-left"},{title:"Direcci\xf3n",data:"direccion",className:"dt-center dt-body-left"},{title:"Comuna",data:"comuna",className:"dt-center dt-body-left"},{title:"Estado",data:"status",width:"5%",className:"dt-center",render:t=>`<span class="${1===t?"badge bg-success":"badge bg-danger"}">${1===t?"Activo":"Inactivo"}</span>`},{title:"Acciones",data:"idCliente",width:"15%",className:"dt-center",orderable:!1,render:(t,i,r)=>`<button class="btn btn-warning btn-sm ms-1" title="Editar" id="update" value="${JSON.stringify(r).replace(/"/g,"'")}">\n                    <i class="c-icon fas fa-edit text-white pe-none"></i>\n                  </button>\n                  <button class="btn btn-danger btn-sm" title="Deshabilitar" id="delete" value="${JSON.stringify(r).replace(/"/g,"'")}">\n                    <i class="c-icon fas fa-trash-alt text-white pe-none"></i>\n                  </button>`}]}action(t){var i;const r=t.action?JSON.parse(null===(i=t.value)||void 0===i?void 0:i.replace(/'/g,'"')):null;switch(t.action){case"update":this.updateClient(null==r?void 0:r.idOficina);break;case"delete":this.deleteOffice(r)}}readClient(t){var i=this;return(0,u.Z)(function*(){var r;i.sweetAlertService.swalLoading();const a=yield i.adminService.GetCustomers(1);i.sweetAlertService.swalClose(),a.success&&a.data?(i.clientData=null===(r=a.data)||void 0===r?void 0:r.listaClientes,t&&i.emitDataService.tableData(i.clientData),i.getColumnas()):i.clientData=[]})()}createClient(){this.router.navigate(["admin/clientes/crear"])}updateClient(t){this.router.navigate(["admin/clientes/editar",t])}deleteOffice(t){var i=this;return(0,u.Z)(function*(){if(yield i.sweetAlertService.swalConfirm("warning","\xbfEst\xe1 seguro?",`Se inhabilitar\xe1 la oficina ${null==t?void 0:t.cliente}`)){i.sweetAlertService.swalLoading();const s=yield i.adminService.DeleteCustomer(null==t?void 0:t.idCliente);i.sweetAlertService.swalClose(),s.success?(yield i.sweetAlertService.swalInfo("success","\xc9xito","Cliente eliminada exitosamente."))&&i.readClient("reload"):i.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",s.message)}})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.F0),e.Y36(h.o),e.Y36(C),e.Y36(A.B),e.Y36(Z.T),e.Y36(_.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-client"]],decls:15,vars:2,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"row"],[1,"col-xl-6"],[1,"text-dark"],[1,"col-xl-6","text-end"],[1,"btn","btn-primary",3,"click"],[1,"c-icon","fas","fa-plus-circle"],[1,"card-body"],["class","col-xl-12 text-center display-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"col-xl-12","text-center","display-4"],[1,"table-responsive"],[3,"columnas","data","dom","buttons","changeAction"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e._uU(6,"Clientes"),e.qZA()(),e.TgZ(7,"div",6)(8,"button",7),e.NdJ("click",function(){return i.createClient()}),e._UZ(9,"i",8),e._uU(10,"\xa0\xa0\xa0Crear Cliente "),e.qZA()()()(),e.TgZ(11,"div",9)(12,"div",3),e.YNc(13,H,3,0,"div",10),e.YNc(14,B,2,7,"div",11),e.qZA()()()()),2&t&&(e.xp6(13),e.Q6J("ngIf",0===i.clientData.length),e.xp6(1),e.Q6J("ngIf",i.clientData.length>0))},directives:[f.O5,T.n],styles:[""]}),o})();var X=c(1100);function W(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un nombre. "),e.qZA())}function ee(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un nombre v\xe1lido. "),e.qZA())}function te(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,W,3,0,"div",38),e.YNc(2,ee,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.nombre.errors.required),e.xp6(1),e.Q6J("ngIf",t.f.nombre.errors.minLength)}}function ie(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un apellido paterno. "),e.qZA())}function re(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un apellido paterno v\xe1lido. "),e.qZA())}function oe(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,ie,3,0,"div",38),e.YNc(2,re,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.apePat.errors.required),e.xp6(1),e.Q6J("ngIf",t.f.apePat.errors.minLength)}}function ne(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un apellido materno. "),e.qZA())}function se(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un apellido materno v\xe1lido. "),e.qZA())}function ae(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,ne,3,0,"div",38),e.YNc(2,se,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.apeMat.errors.required),e.xp6(1),e.Q6J("ngIf",t.f.apeMat.errors.minLength)}}function le(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un rut. "),e.qZA())}function ue(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un rut v\xe1lido. "),e.qZA())}function ce(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,le,3,0,"div",38),e.YNc(2,ue,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.rut.errors.required),e.xp6(1),e.Q6J("ngIf",(null==t.f.rut.value?null:t.f.rut.value.length)>0&&t.f.rut.errors.rutInvalid)}}function de(o,n){if(1&o&&(e.TgZ(0,"option",40),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.nombre," ")}}function me(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, seleccione un perfil. "),e.qZA())}function fe(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,me,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.perfil.errors.required)}}function ve(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un clave. "),e.qZA())}function pe(o,n){1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",39),e._uU(2," Por favor, ingresa un clave v\xe1lido. "),e.qZA())}function ge(o,n){if(1&o&&(e.TgZ(0,"div",37),e.YNc(1,ve,3,0,"div",38),e.YNc(2,pe,3,0,"div",38),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.clave.errors.required),e.xp6(1),e.Q6J("ngIf",t.f.clave.errors.minLength)}}const _e=function(){return["/admin/usuarios"]},g=function(o){return{"is-invalid":o}};let w=(()=>{class o{constructor(t,i,r,s,a,d,b,Se){this.router=t,this.route=i,this.rutService=r,this.authService=s,this.formBuilder=a,this.sweetAlertService=d,this.adminService=b,this.localSecureService=Se,this.title="Crear",this.edit=!1,this.perfiles=[],this.isSubmitted=!1}ngOnInit(){this.validaUser()}validaUser(){var t=this;return(0,u.Z)(function*(){t.usuario=t.localSecureService.getValue("currentUser"),1===t.usuario.idPerfil?(t.initForm(),t.getParams()):(yield t.sweetAlertService.swalInfo("warning","\xa1Lo sentimos!","No posee los permisos necesarios para realizar esta acci\xf3n."))&&t.router.navigate(["/dashboard"])})()}getParams(){var t=this;return(0,u.Z)(function*(){yield t.getPerfil(),t.idUser=parseInt(t.route.snapshot.paramMap.get("id")||"0",10),t.idUser>0&&(t.title="Editar",t.edit=!0,t.readUser())})()}get f(){return this.formulario.controls}initForm(){this.formulario=this.formBuilder.group({rut:["",[l.kI.required,this.rutService.validarRut()]],nombre:["",[l.kI.required,l.kI.minLength(3)]],apePat:["",[l.kI.required,l.kI.minLength(3)]],apeMat:["",[l.kI.required]],perfil:["",[l.kI.required]],clave:["",[l.kI.required,l.kI.minLength(8)]],status:[!0]})}formaterRut(){this.formulario.patchValue({rut:this.rutService.formateaRut(this.formulario.value.rut)})}setSelect(){this.formulario.patchValue({perfil:this.perfiles})}setValues(t){this.formulario.patchValue({rut:this.rutService.formateaRut(t.rut),nombre:t.nombre,apePat:t.apellidoP,apeMat:t.apellidoM,perfil:this.perfiles.find(i=>i.id===t.idPerfil).id,clave:"",status:1===t.ok}),this.f.rut.disable()}getPerfil(){var t=this;return(0,u.Z)(function*(){t.sweetAlertService.swalLoading();const i=yield t.authService.getRoles();t.sweetAlertService.swalClose(),i.success?t.perfiles=1===t.usuario.idPerfil?i.data:i.data.filter(r=>1!==r.id):(yield t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",i.message))&&t.router.navigate(["admin/usuarios"])})()}readUser(){var t=this;return(0,u.Z)(function*(){t.sweetAlertService.swalLoading();const i=yield t.adminService.GetUsers(t.idUser);t.sweetAlertService.swalClose(),i.success?t.setValues(i.data):(yield t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",i.message))&&t.router.navigate(["admin/usuarios"])})()}onSubmit(){this.isSubmitted=!0,""===this.f.clave.value?(this.formulario.controls.clave.clearValidators(),this.formulario.controls.clave.updateValueAndValidity()):(this.formulario.controls.clave.setValidators([l.kI.required,l.kI.minLength(8)]),this.formulario.controls.clave.updateValueAndValidity()),!this.formulario.invalid&&(this.idUser>0?this.updateUser():this.createUser())}updateUser(){var t=this;return(0,u.Z)(function*(){var i;const r=t.f.rut.value.substr(0,t.f.rut.value.length-1).replace(/\./g,""),s={userupdt:{idUsuario:null!==(i=t.idUser)&&void 0!==i?i:0,rut:t.f.rut.value.replace(/\./g,""),nombre:t.f.nombre.value,apellidoP:t.f.apePat.value,apellidoM:t.f.apeMat.value,ok:t.f.status.value?1:0,idPerfil:parseInt(t.f.perfil.value,10),password:""===t.f.clave.value?null:t.f.clave.value,idUsuarioSolicitante:t.usuario.idusuario}};t.sweetAlertService.swalLoading();const a=yield t.adminService.UpdateUser(s);t.sweetAlertService.swalClose(),a.success?(parseInt(r,10)===parseInt(t.usuario.rut,10)&&(t.localSecureService.removeItem("currentUser"),t.localSecureService.setValue("currentUser",t.usuario)),yield t.sweetAlertService.swalInfo("success","\xa1Editado!","\xa1El usuario ha sido editado con \xe9xito!"),t.router.navigate(["admin/usuarios"])):t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",a.message)})()}createUser(){var t=this;return(0,u.Z)(function*(){var i;const r=t.f.rut.value.substr(0,t.f.rut.value.length-1).replace(/\./g,""),s={userupdt:{idUsuario:null!==(i=t.idUser)&&void 0!==i?i:0,rut:t.f.rut.value.replace(/\./g,""),nombre:t.f.nombre.value,apellidoP:t.f.apePat.value,apellidoM:t.f.apeMat.value,ok:t.f.status.value?1:0,idPerfil:parseInt(t.f.perfil.value,10),password:""===t.f.clave.value?null:t.f.clave.value,idUsuarioSolicitante:t.usuario.idusuario}};t.sweetAlertService.swalLoading();const a=yield t.adminService.CreateUser(s);t.sweetAlertService.swalClose(),a.success?(parseInt(r,10)===parseInt(t.usuario.rut,10)&&(t.localSecureService.removeItem("currentUser"),t.localSecureService.setValue("currentUser",t.usuario)),yield t.sweetAlertService.swalInfo("success","\xa1Creado!","\xa1El usuario ha sido creado con \xe9xito!"),t.router.navigate(["admin/usuarios"])):t.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",a.message)})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.F0),e.Y36(m.gz),e.Y36(h.o),e.Y36(X.e),e.Y36(l.qu),e.Y36(Z.T),e.Y36(C),e.Y36(_.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-form-user"]],decls:62,vars:30,consts:[[1,"container-fluid"],[1,"row"],[1,"col-xl-8","mx-auto"],[1,"card"],[1,"card-header","mt-2"],[1,"col-xl-6"],[1,"text-dark","text-start"],[1,"col-xl-6","text-end"],[1,"btn","btn-primary","text-white",3,"routerLink"],[1,"c-icon","fas","fa-arrow-left"],[1,"card-body"],[1,"row",3,"formGroup","ngSubmit"],[1,"col-xl-4"],["for","nombre"],["type","text","formControlName","nombre",1,"form-control","text-capitalize",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","apePat"],["type","text","formControlName","apePat",1,"form-control","text-capitalize",3,"ngClass"],["for","apeMat"],["type","text","formControlName","apeMat",1,"form-control","text-capitalize",3,"ngClass"],[1,"col-xl-6","mt-xl-3"],["for","rut"],["type","text","formControlName","rut","maxlength","12",1,"form-control","text-capitalize",3,"ngClass","keyup"],["for","perfil"],["formControlName","perfil",1,"form-select",3,"ngClass"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","clave"],["type","password","formControlName","clave",1,"form-control",3,"ngClass"],[1,"text-muted"],[1,"col-xl-6","mx-auto","mt-xl-4"],[1,"form-check","form-switch","text-center"],[1,"form-check-label"],[1,"switch"],["type","checkbox","formControlName","status",1,"form-check-input"],[1,"col-xl-12","text-center","mt-5"],["type","submit",1,"btn","btn-primary"],[1,"invalid-feedback"],[4,"ngIf"],[1,"far","fa-times-circle"],[3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",1)(6,"div",5)(7,"h4",6),e._uU(8),e.qZA()(),e.TgZ(9,"div",7)(10,"button",8),e._UZ(11,"i",9),e._uU(12,"\xa0\xa0\xa0Volver "),e.qZA()()()(),e.TgZ(13,"div",10)(14,"form",11),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(15,"div",12)(16,"label",13),e._uU(17,"Nombre"),e.qZA(),e._UZ(18,"input",14),e.YNc(19,te,3,2,"div",15),e.qZA(),e.TgZ(20,"div",12)(21,"label",16),e._uU(22,"Apellido Paterno"),e.qZA(),e._UZ(23,"input",17),e.YNc(24,oe,3,2,"div",15),e.qZA(),e.TgZ(25,"div",12)(26,"label",18),e._uU(27,"Apellido Materno"),e.qZA(),e._UZ(28,"input",19),e.YNc(29,ae,3,2,"div",15),e.qZA(),e.TgZ(30,"div",20)(31,"label",21),e._uU(32,"RUT"),e.qZA(),e.TgZ(33,"input",22),e.NdJ("keyup",function(){return i.formaterRut()}),e.qZA(),e.YNc(34,ce,3,2,"div",15),e.qZA(),e.TgZ(35,"div",20)(36,"label",23),e._uU(37,"Perfil"),e.qZA(),e.TgZ(38,"select",24)(39,"option",25),e._uU(40,"Seleccione..."),e.qZA(),e.YNc(41,de,2,2,"option",26),e.qZA(),e.YNc(42,fe,2,1,"div",15),e.qZA(),e.TgZ(43,"div",20)(44,"label",27),e._uU(45,"Clave"),e.qZA(),e._UZ(46,"input",28),e.TgZ(47,"small",29),e._uU(48," Clave debe ser m\xednimo de 8 caracteres. "),e.qZA(),e.YNc(49,ge,3,2,"div",15),e.qZA(),e.TgZ(50,"div",30)(51,"div",31)(52,"label",32),e._uU(53," Puede habilitar o deshabilitar usuario "),e.qZA(),e._UZ(54,"br"),e.TgZ(55,"label",33),e._UZ(56,"input",34),e.qZA(),e.TgZ(57,"span"),e._uU(58),e.qZA()()(),e.TgZ(59,"div",35)(60,"button",36),e._uU(61,"Guardar"),e.qZA()()()()()()()()),2&t&&(e.xp6(8),e.hij("",i.title," Usuario"),e.xp6(2),e.Q6J("routerLink",e.DdM(17,_e)),e.xp6(4),e.Q6J("formGroup",i.formulario),e.xp6(4),e.Q6J("ngClass",e.VKq(18,g,i.isSubmitted&&i.f.nombre.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.nombre.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(20,g,i.isSubmitted&&i.f.apePat.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.apePat.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(22,g,i.isSubmitted&&i.f.apeMat.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.apeMat.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(24,g,i.isSubmitted&&i.f.rut.errors)),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.rut.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(26,g,i.isSubmitted&&i.f.perfil.errors)),e.xp6(3),e.Q6J("ngForOf",i.perfiles),e.xp6(1),e.Q6J("ngIf",i.isSubmitted&&i.f.perfil.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(28,g,i.isSubmitted&&i.f.clave.errors)),e.xp6(3),e.Q6J("ngIf",i.isSubmitted&&i.f.clave.errors),e.xp6(9),e.hij(" ",i.f.status.value?"Habilitado":"Deshabilitado"," "))},directives:[m.rH,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,f.mk,f.O5,l.nD,l.EJ,l.YN,l.Kr,f.sg,l.Wl],styles:[""]}),o})();function he(o,n){1&o&&(e.TgZ(0,"div",12)(1,"h4"),e._uU(2," Sin registros de usuarios "),e.qZA()())}const Ce=function(){return[]};function Ze(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"app-datatable",14),e.NdJ("changeAction",function(r){return e.CHM(t),e.oxw().action(r)}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Tol("table-bordered border fs-6"),e.Q6J("columnas",t.columns)("data",t.usersData)("dom",t.dom)("buttons",e.DdM(6,Ce))}}const be=[{path:"",data:{title:"Administraci\xf3n"},children:[{path:"",redirectTo:"usuarios"},{path:"usuarios",component:(()=>{class o{constructor(t,i,r,s,a,d){this.router=t,this.rutService=i,this.adminService=r,this.emitDataService=s,this.sweetAlertService=a,this.localSecureService=d,this.usersData=[],this.columns=[],this.dom=""}ngOnInit(){this.validaUser()}validaUser(){var t=this;return(0,u.Z)(function*(){t.usuario=t.localSecureService.getValue("currentUser"),1===t.usuario.idPerfil?t.getUsers():(yield t.sweetAlertService.swalInfo("warning","\xa1Lo sentimos!","No posee los permisos necesarios para ver este \xedtem."))&&t.router.navigate(["/dashboard"])})()}getColumnas(){this.dom='<"row"<"col-xl-6"B><"col-xl-6"f>><"row"<"col-xl-12"tr>><"row"<"col-xl-4"i><"col-xl-4"l><"col-xl-4"p>>',this.columns=[{data:"idUsuario",orderable:!1,visible:!1},{title:"Rut",data:"rut"},{title:"Nombre",defaultContent:"",render:(t,i,r)=>`${null==r?void 0:r.nombre} ${null==r?void 0:r.apaterno} ${null==r?void 0:r.amaterno}`},{title:"Email",data:"email"},{title:"Tel\xe9fono",data:"telefono"},{title:"Perfil",data:"perfil"},{title:"Estado",data:"ok",width:"5%",className:"dt-center",render:t=>`<span class="${1===t?"badge bg-success":"badge bg-danger"}">${1===t?"Activo":"Inactivo"}</span>`},{title:"Acciones",width:"10%",className:"dt-center",orderable:!1,defaultContent:"",render:(t,i,r)=>`<button type="button" class="btn btn-warning btn-sm ms-1" title="Editar" id="update" value="${JSON.stringify(r).replace(/"/g,"'")}">\n                    <i class="c-icon fas fa-edit text-white pe-none"></i>\n                  </button>\n                  <button type="button" class="btn btn-danger btn-sm" title="Eliminar" id="delete" value="${JSON.stringify(r).replace(/"/g,"'")}">\n                    <i class="c-icon fas fa-trash-alt text-white pe-none"></i>\n                  </button>`}]}action(t){var i;const r=t.action?JSON.parse(null===(i=t.value)||void 0===i?void 0:i.replace(/'/g,'"')):null;switch(t.action){case"update":this.updateUser(null==r?void 0:r.idUsuario);break;case"delete":this.deleteUser(r)}}getUsers(t){var i=this;return(0,u.Z)(function*(){i.sweetAlertService.swalLoading();const r=yield i.adminService.GetUsers(i.usuario.idUsuario);i.sweetAlertService.swalClose(),r.success&&r.data?(i.usersData=r.data,t&&i.emitDataService.tableData(i.usersData),i.getColumnas()):i.usersData=[]})()}createUser(){this.router.navigate(["admin/usuarios/crear"])}updateUser(t){this.router.navigate(["admin/usuarios/editar",t])}deleteUser(t){var i=this;return(0,u.Z)(function*(){if(yield i.sweetAlertService.swalConfirm("warning","\xbfEst\xe1 seguro?",`Se eliminar\xe1 usuario RUT ${i.rutService.formateaRut(t.rut)}`)){i.sweetAlertService.swalLoading();const s=yield i.adminService.DeleteUser(null==t?void 0:t.idUsuario);i.sweetAlertService.swalClose(),s.success?(yield i.sweetAlertService.swalInfo("success","\xc9xito","Usuario eliminado exitosamente."))&&i.getUsers("reload"):i.sweetAlertService.swalInfo("error","\xa1Lo sentimos!",s.message)}})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.F0),e.Y36(h.o),e.Y36(C),e.Y36(A.B),e.Y36(Z.T),e.Y36(_.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-users"]],decls:15,vars:2,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"row"],[1,"col-xl-6"],[1,"text-dark"],[1,"col-xl-6","text-end"],[1,"btn","btn-primary",3,"click"],[1,"c-icon","fas","fa-plus-circle"],[1,"card-body"],["class","col-xl-12 text-center display-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"col-xl-12","text-center","display-4"],[1,"table-responsive"],[3,"columnas","data","dom","buttons","changeAction"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e._uU(6,"Usuarios"),e.qZA()(),e.TgZ(7,"div",6)(8,"button",7),e.NdJ("click",function(){return i.createUser()}),e._UZ(9,"i",8),e._uU(10,"\xa0\xa0\xa0Crear Usuario "),e.qZA()()()(),e.TgZ(11,"div",9)(12,"div",3),e.YNc(13,he,3,0,"div",10),e.YNc(14,Ze,2,7,"div",11),e.qZA()()()()),2&t&&(e.xp6(13),e.Q6J("ngIf",0===i.usersData.length),e.xp6(1),e.Q6J("ngIf",i.usersData.length>0))},directives:[f.O5,T.n],styles:[""]}),o})()},{path:"usuarios/crear",component:w},{path:"usuarios/editar/:id",component:w},{path:"clientes",component:j},{path:"clientes/crear",component:S},{path:"clientes/editar/:id",component:S}]}];let Ue=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[m.Bz.forChild(be)],m.Bz]}),o})(),xe=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[f.ez,Ue,l.u5,l.UX,y.m]]}),o})()}}]);