"use strict";(self.webpackChunksecurework_front=self.webpackChunksecurework_front||[]).push([[132],{9132:(H,_,l)=>{l.r(_),l.d(_,{ClientesModule:()=>R});var u=l(9808),c=l(2382),b=l(3865),p=l(8578),m=l(5861),e=l(4893),h=l(1100),Z=l(520),g=l(4464),T=l(1665),y=l(1553);let A=(()=>{class s{constructor(t,r,i){this.configService=t,this.httpClient=r,this.localSecureService=i,this.headers=new Z.WM({Accept:"application/json","Content-Type":"application/json; charset=utf-8"})}setHeaders(t){const r=this.localSecureService.getValue("currentUser"),i=r?`${r.token}`:"";let o=this.headers.set("ApiKey",t);return o=o.set("Authorization",`Bearer ${i}`),o}GetDatosEmpresa(t){var r=this;return(0,m.Z)(function*(){try{const i=yield r.configService.getConfig(),n=`${i.api_url}/Cliente/GetDatosEmpresa?idUsuario=${t}`,d=r.setHeaders(i.apikey);return yield(0,g.n)(r.httpClient.get(n,{headers:d}))}catch(i){return{status:!1,code:null==i?void 0:i.status,message:null==i?void 0:i.statusText}}})()}IngresarAlerta(t){var r=this;return(0,m.Z)(function*(){try{const i=yield r.configService.getConfig(),o=`${i.api_url}/Cliente/IngresarAlerta`,n=r.setHeaders(i.apikey);return yield(0,g.n)(r.httpClient.post(o,t,{headers:n}))}catch(i){return{status:!1,code:null==i?void 0:i.status,message:null==i?void 0:i.statusText}}})()}SolicitarAsesoriaEsp(t){var r=this;return(0,m.Z)(function*(){try{const i=yield r.configService.getConfig(),o=`${i.api_url}/Cliente/SolicitarAsesoriaEsp`,n=r.setHeaders(i.apikey);return yield(0,g.n)(r.httpClient.post(o,t,{headers:n}))}catch(i){return{status:!1,code:null==i?void 0:i.status,message:null==i?void 0:i.statusText}}})()}GetAlertas(t){var r=this;return(0,m.Z)(function*(){try{const i=yield r.configService.getConfig(),n=`${i.api_url}/Cliente/GetAlertas?idCliente=${t}`,d=r.setHeaders(i.apikey);return yield(0,g.n)(r.httpClient.get(n,{headers:d}))}catch(i){return{status:!1,code:null==i?void 0:i.status,message:null==i?void 0:i.statusText}}})()}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(T.E),e.LFG(Z.eN),e.LFG(y.b))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var S=l(5888),C=l(5459);function w(s,a){1&s&&(e.TgZ(0,"div"),e._UZ(1,"i",18),e._uU(2," Por favor, selecciona una fecha. "),e.qZA())}function I(s,a){if(1&s&&(e.TgZ(0,"div",16),e.YNc(1,w,3,0,"div",17),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.fecha.errors.required)}}function Y(s,a){1&s&&(e.TgZ(0,"div"),e._UZ(1,"i",18),e._uU(2," Por favor, selecciona una hora. "),e.qZA())}function F(s,a){if(1&s&&(e.TgZ(0,"div",16),e.YNc(1,Y,3,0,"div",17),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.hora.errors.required)}}function U(s,a){1&s&&(e.TgZ(0,"div"),e._UZ(1,"i",18),e._uU(2," Por favor, ingrese descripci\xf3n. "),e.qZA())}function q(s,a){if(1&s&&(e.TgZ(0,"div",16),e.YNc(1,U,3,0,"div",17),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.descripcion.errors.required)}}const x=function(s){return{"is-invalid":s}};let N=(()=>{class s{constructor(t,r,i,o,n,d,v,f){this.router=t,this.datePipe=r,this.route=i,this.formBuilder=o,this.authService=n,this.clienteService=d,this.dataSecureService=v,this.sweetAlertService=f,this.isSubmitted=!1}ngOnInit(){this.checkEmpresa(),this.initForm()}checkEmpresa(){const t=this.route.snapshot.queryParams.empresa;this.empresa=t?this.dataSecureService.objectDecrypt(t):null}get f(){return this.formulario.controls}initForm(){this.formulario=this.formBuilder.group({fecha:["",c.kI.required],hora:["",c.kI.required],descripcion:["",c.kI.required]}),this.formulario.patchValue({fecha:this.datePipe.transform(Date.now(),"yyyy-MM-dd")})}onSubmit(){this.isSubmitted=!0,!this.formulario.invalid&&this.ingresarAlerta()}ingresarAlerta(){var t=this;return(0,m.Z)(function*(){var r,i;t.sweetAlertService.swalLoading();const o={fechaAccidente:`${t.f.fecha.value} ${t.f.hora.value}:00`,descripcion:t.f.descripcion.value,idCliente:null!==(i=null===(r=t.empresa)||void 0===r?void 0:r.idCliente)&&void 0!==i?i:0},n=yield t.clienteService.IngresarAlerta(o);t.sweetAlertService.swalClose(),n.success?(yield t.sweetAlertService.swalInfo("success","\xc9xito","Alerta ingresada"),t.router.navigate(["/cliente/accidentes"])):(401===n.code||0===n.code)&&t.authService.sessionExpired()})()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(p.F0),e.Y36(u.uU),e.Y36(p.gz),e.Y36(c.qu),e.Y36(h.e),e.Y36(A),e.Y36(S.X),e.Y36(C.T))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-ingresar-alerta"]],decls:27,vars:13,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"text-dark"],[1,"card-body"],[1,"row"],[1,"col-xl-10","mx-auto"],[1,"row",3,"formGroup","ngSubmit"],[1,"col-xl-4","mx-auto","my-4"],["type","date","placeholder","DD/MM/AAAA","formControlName","fecha",1,"form-control","text-center",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","time","placeholder","HH:mm","formControlName","hora",1,"form-control","text-center",3,"ngClass"],[1,"col-xl-6","mx-auto","my-4"],["type","text","formControlName","descripcion","cols","30","rows","10",1,"form-control",3,"ngClass"],[1,"col-xl-12","text-center","mt-5"],["type","submit",1,"btn","btn-primary"],[1,"invalid-feedback"],[4,"ngIf"],[1,"far","fa-times-circle"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4,"Ingresar Alerta"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"form",7),e.NdJ("ngSubmit",function(){return r.onSubmit()}),e.TgZ(9,"div",8)(10,"h6"),e._uU(11,"Fecha Accidente"),e.qZA(),e._UZ(12,"input",9),e.YNc(13,I,2,1,"div",10),e.qZA(),e.TgZ(14,"div",8)(15,"h6"),e._uU(16,"Hora Accidente"),e.qZA(),e._UZ(17,"input",11),e.YNc(18,F,2,1,"div",10),e.qZA(),e.TgZ(19,"div",12)(20,"h6"),e._uU(21,"Descripci\xf3n"),e.qZA(),e._UZ(22,"textarea",13),e.YNc(23,q,2,1,"div",10),e.qZA(),e.TgZ(24,"div",14)(25,"button",15),e._uU(26,"Guardar"),e.qZA()()()()()()()()),2&t&&(e.xp6(8),e.Q6J("formGroup",r.formulario),e.xp6(4),e.Q6J("ngClass",e.VKq(7,x,r.isSubmitted&&r.f.fecha.invalid)),e.xp6(1),e.Q6J("ngIf",r.isSubmitted&&r.f.fecha.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(9,x,r.isSubmitted&&r.f.hora.invalid)),e.xp6(1),e.Q6J("ngIf",r.isSubmitted&&r.f.hora.errors),e.xp6(4),e.Q6J("ngClass",e.VKq(11,x,r.isSubmitted&&r.f.descripcion.errors)),e.xp6(1),e.Q6J("ngIf",r.isSubmitted&&r.f.descripcion.errors))},directives:[c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,u.mk,u.O5],styles:[""]}),s})();var E=l(6936);function J(s,a){1&s&&(e.TgZ(0,"div",8)(1,"h4"),e._uU(2," Sin registros de alertas "),e.qZA()())}function D(s,a){if(1&s&&(e.TgZ(0,"div",9),e._UZ(1,"app-datatable",10),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Tol("table-bordered border fs-6"),e.Q6J("columnas",t.columns)("data",t.data)("dom",t.dom)("buttons",t.buttons)}}let k=(()=>{class s{constructor(t,r,i,o,n,d,v,f){this.router=t,this.datePipe=r,this.route=i,this.authService=o,this.clienteService=n,this.dataSecureService=d,this.sweetAlertService=v,this.localSecureService=f,this.data=[],this.columns=[],this.dom="",this.buttons=[]}ngOnInit(){this.validaUser()}validaUser(){var t=this;return(0,m.Z)(function*(){2===t.localSecureService.getValue("currentUser").idPerfil?t.checkEmpresa():(yield t.sweetAlertService.swalInfo("warning","\xa1Lo sentimos!","No posee los permisos necesarios para ver este \xedtem."))&&t.router.navigate(["/dashboard"])})()}checkEmpresa(){const t=this.route.snapshot.queryParams.empresa;this.empresa=t?this.dataSecureService.objectDecrypt(t):null,this.empresa?this.getAlertas():this.router.navigate(["/cliente"])}getColumnas(){this.dom='<"row"<"col-xl-6"B><"col-xl-6"f>><"row"<"col-xl-12"tr>><"row"<"col-xl-4"i><"col-xl-4"l><"col-xl-4"p>>',this.columns=[{title:"Fecha de accidente",data:"fechaAccidente",className:"dt-center",render:t=>this.datePipe.transform(t,"dd-MM-yyyy hh:ss")},{title:"Descripci\xf3n",data:"descripcion",className:"dt-center dt-body-left",orderable:!1},{title:"Estado",data:"idEstado",width:"5%",className:"dt-center",render:(t,r,i)=>`<span class="${3===t?"badge bg-success":1===t?"badge bg-info":"badge bg-danger"}">${i.estado}</span>`}]}getAlertas(){var t=this;return(0,m.Z)(function*(){var r,i;t.sweetAlertService.swalLoading();const o=null!==(i=null===(r=t.empresa)||void 0===r?void 0:r.idCliente)&&void 0!==i?i:0,n=yield t.clienteService.GetAlertas(o);t.sweetAlertService.swalClose(),n.success?(t.data=n.data,t.getButtonTable(),t.getColumnas()):(401===n.code||0===n.code)&&t.authService.sessionExpired()})()}getButtonTable(){this.buttons=[{extend:"excel",title:"Alertas",text:'<i class="far fa-file-excel text-white"></i> Exportar a Excel',className:"btn btn-success text-white",sheetName:"Alertas",exportOptions:{columns:[0,1,2]}}]}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(p.F0),e.Y36(u.uU),e.Y36(p.gz),e.Y36(h.e),e.Y36(A),e.Y36(S.X),e.Y36(C.T),e.Y36(y.b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-revisar-alertas"]],decls:9,vars:2,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"text-dark"],[1,"card-body"],[1,"row"],["class","col-xl-12 text-center display-4",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"col-xl-12","text-center","display-4"],[1,"table-responsive"],[3,"columnas","data","dom","buttons"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4,"Accidentes ingresados"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5),e.YNc(7,J,3,0,"div",6),e.YNc(8,D,2,6,"div",7),e.qZA()()()()),2&t&&(e.xp6(7),e.Q6J("ngIf",0===r.data.length),e.xp6(1),e.Q6J("ngIf",r.data.length>0))},directives:[u.O5,E.n],styles:[""]}),s})();function M(s,a){1&s&&(e.TgZ(0,"div"),e._UZ(1,"i",16),e._uU(2," Por favor, ingrese descripci\xf3n. "),e.qZA())}function P(s,a){if(1&s&&(e.TgZ(0,"div",14),e.YNc(1,M,3,0,"div",15),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.f.descripcion.errors.required)}}const Q=function(s){return{"is-invalid":s}};let B=(()=>{class s{constructor(t,r,i,o,n,d,v,f){this.router=t,this.datePipe=r,this.route=i,this.formBuilder=o,this.authService=n,this.clienteService=d,this.dataSecureService=v,this.sweetAlertService=f,this.isSubmitted=!1,this.fileBase64=""}ngOnInit(){this.checkEmpresa(),this.initForm()}checkEmpresa(){const t=this.route.snapshot.queryParams.empresa;this.empresa=t?this.dataSecureService.objectDecrypt(t):null,console.log("Empresa:",this.empresa)}get f(){return this.formulario.controls}initForm(){this.formulario=this.formBuilder.group({descripcion:["",c.kI.required],archivo:[""]}),this.setForm()}setForm(){const t=new Date,r=t.setDate(t.getDate()+1);this.minDate=this.datePipe.transform(r,"yyyy-MM-dd"),this.formulario.patchValue({fecha:this.datePipe.transform(r,"yyyy-MM-dd")})}onSubmit(){this.isSubmitted=!0,!this.formulario.invalid&&this.CrearCasoAsesoria()}CrearCasoAsesoria(){var t=this;return(0,m.Z)(function*(){var r,i;t.sweetAlertService.swalLoading();const o={descripcion:t.f.descripcion.value,fechaIngreso:t.datePipe.transform(Date.now(),"yyyy-MM-dd HH:mm:ss"),documentoB64:null==t.fileBase64?null:t.fileBase64,idCliente:null!==(i=null===(r=t.empresa)||void 0===r?void 0:r.idCliente)&&void 0!==i?i:""},n=yield t.clienteService.SolicitarAsesoriaEsp(o);t.sweetAlertService.swalClose(),n.success?(yield t.sweetAlertService.swalInfo("success","\xc9xito","Asesor\xeda ingresada"),t.router.navigate(["/cliente"])):(401===n.code||0===n.code)&&t.authService.sessionExpired()})()}readFile(t){const r=t.target.files[0],i=new FileReader;i.readAsDataURL(r),i.onload=()=>{var o,n;const d=null===(o=i.result)||void 0===o?void 0:o.toString();this.fileBase64=null===(n=null==d?void 0:d.split(","))||void 0===n?void 0:n[1]}}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(p.F0),e.Y36(u.uU),e.Y36(p.gz),e.Y36(c.qu),e.Y36(h.e),e.Y36(A),e.Y36(S.X),e.Y36(C.T))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-solicitar-asesoria"]],decls:21,vars:5,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"text-dark"],[1,"card-body"],[1,"row"],[1,"col-xl-10","mx-auto"],[1,"row",3,"formGroup","ngSubmit"],[1,"col-xl-6","mx-auto","my-4"],["type","text","formControlName","descripcion","cols","30","rows","10",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","file","id","formFile",1,"form-control",3,"change"],[1,"col-xl-12","text-center","mt-5"],["type","submit",1,"btn","btn-primary"],[1,"invalid-feedback"],[4,"ngIf"],[1,"far","fa-times-circle"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4,"Solicitar Asesor\xeda"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"form",7),e.NdJ("ngSubmit",function(){return r.onSubmit()}),e.TgZ(9,"div",8)(10,"h6"),e._uU(11,"Descripci\xf3n"),e.qZA(),e._UZ(12,"textarea",9),e.YNc(13,P,2,1,"div",10),e.qZA(),e.TgZ(14,"div",8)(15,"h6"),e._uU(16,"Seleccionar Archivo"),e.qZA(),e.TgZ(17,"input",11),e.NdJ("change",function(o){return r.readFile(o)}),e.qZA()(),e.TgZ(18,"div",12)(19,"button",13),e._uU(20,"Guardar"),e.qZA()()()()()()()()),2&t&&(e.xp6(8),e.Q6J("formGroup",r.formulario),e.xp6(4),e.Q6J("ngClass",e.VKq(3,Q,r.isSubmitted&&r.f.descripcion.errors)),e.xp6(1),e.Q6J("ngIf",r.isSubmitted&&r.f.descripcion.errors))},directives:[c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,u.mk,u.O5],styles:[""]}),s})();function O(s,a){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.oxw().redirect(o.url)}),e.TgZ(2,"h4"),e._uU(3),e.qZA()(),e.BQk()}if(2&s){const t=a.$implicit;e.xp6(3),e.Oqu(t.target)}}const G=[{path:"",data:{title:"Cliente"},children:[{path:"",component:(()=>{class s{constructor(t,r,i,o,n,d){this.router=t,this.authService=r,this.clienteService=i,this.sweetAlertService=o,this.dataSecureService=n,this.localSecureService=d}ngOnInit(){this.getDatosEmpresa()}getOptions(){this.options=[{id:1,target:"Reportar Accidente",url:"/cliente/reportar"},{id:2,target:"Solicitar Asesor\xeda",url:"/cliente/asesoria"},{id:3,target:"Accidentes ingresados",url:"/cliente/accidentes"}]}getDatosEmpresa(){var t=this;return(0,m.Z)(function*(){t.sweetAlertService.swalLoading();const r=t.localSecureService.getValue("currentUser"),i=yield t.clienteService.GetDatosEmpresa(r.idUsuario);t.sweetAlertService.swalClose(),i.success?(t.empresa=i.data,t.getOptions()):(401===i.code||0===i.code)&&t.authService.sessionExpired()})()}redirect(t){const r=this.dataSecureService.encrypt(this.empresa);this.router.navigate([t],{queryParams:{empresa:r}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(p.F0),e.Y36(h.e),e.Y36(A),e.Y36(C.T),e.Y36(S.X),e.Y36(y.b))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-clientes"]],decls:10,vars:1,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","mt-2"],[1,"text-dark","text-center"],[1,"card-body","mt-2"],[1,"row"],[1,"col-xl-8","mx-auto"],[1,"nav","nav-pills","flex-column"],[4,"ngFor","ngForOf"],["type","button","data-coreui-toggle","pill",1,"btn","btn-outline-primary",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4,"Men\xfa"),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),e.YNc(9,O,4,1,"ng-container",8),e.qZA()()()()()()),2&t&&(e.xp6(9),e.Q6J("ngForOf",r.options))},directives:[u.sg],styles:[""]}),s})()},{path:"reportar",component:N},{path:"asesoria",component:B},{path:"accidentes",component:k}]}];let $=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[p.Bz.forChild(G)],p.Bz]}),s})(),R=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[u.ez,$,c.u5,c.UX,b.m]]}),s})()}}]);